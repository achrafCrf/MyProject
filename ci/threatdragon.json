
{
  "version": "2.0",
  "summary": "Mini ARKENS SV Architecture",
  "detail": "Prototype BBB1/BBB2 avec MMS-like (UDP) et HTTP (ArkStudio) pour configuration; Watchdog + Scheduler APS.",
  "diagrams": [
    {
      "id": "dfd-arkens",
      "title": "Architecture Mini ARKENS SV",
      "diagramType": "DFD",
      "trustBoundaries": [
        {
          "id": "tb1",
          "name": "Zone 192.168.7.x (Config)",
          "description": "PC1 (intervention) ↔ BBB1 via HTTP/SSH (USB gadget).",
          "elements": ["pc1", "bbb1"]
        },
        {
          "id": "tb2",
          "name": "Zone 192.168.0.x (Protection MMS)",
          "description": "Multicast MMS (239.0.0.1:5005) entre BBB1 et BBB2; TTL=1.",
          "elements": ["bbb1", "bbb2"]
        },
        {
          "id": "tb3",
          "name": "Zone 192.168.8.x (SCADA)",
          "description": "BBB2 (eth1 192.168.8.2) ↔ PC2 (192.168.8.1) en UDP unicast (5006).",
          "elements": ["bbb2", "pc2"]
        }
      ],
      "nodes": [
        {
          "id": "pc1",
          "name": "PC1 Config",
          "type": "ExternalEntity",
          "description": "Opérateur (intervention) pour configuration ArkStudio HTTP/SSH.",
          "properties": {
            "ip": "192.168.7.1",
            "role": "Operator workstation"
          }
        },
        {
          "id": "bbb1",
          "name": "BBB1 Arkens SV",
          "type": "Process",
          "description": "Protection: acquisition HC-SR04 (analogique), LEDs (logique), seuil/TMS, watchdog; serveur HTTP ArkStudio.",
          "properties": {
            "ip_eth0": "192.168.0.101",
            "ip_usb": "192.168.7.3",
            "scheduler": "APS 100ms RT",
            "watchdog_ms": 1500
          }
        },
        {
            "id": "bbb2",
            "name": "BBB2 Arkens CP",
            "type": "Process",
            "description": "Receiver MMS multicast; forward UDP unicast vers PC2; journalisation locale.",
            "properties": {
              "ip_eth0": "192.168.0.102",
              "ip_eth1": "192.168.8.2"
            }
        },
        {
          "id": "pc2",
          "name": "PC2 SCADA",
          "type": "ExternalEntity",
          "description": "Supervision: listener UDP (PowerShell/Python/ncat).",
          "properties": {
            "ip": "192.168.8.1",
            "port": 5006
          }
        },
        {
          "id": "sensor",
          "name": "HC-SR04 (capteurs)",
          "type": "DataStore",
          "description": "Capteurs simulant analogique (durée impulsion → RMS).",
          "properties": { "interface": "TRIG P9_41, ECHO P9_15" }
        },
        {
          "id": "leds",
          "name": "LEDs (disjoncteur)",
          "type": "DataStore",
          "description": "TOR: LED rouge (trip), LED verte (normal).",
          "properties": { "lines": "P8_13 (rouge), P8_19 (verte)" }
        }
      ],
      "flows": [
        {
          "id": "f_sensor",
          "source": "sensor",
          "target": "bbb1",
          "name": "Acquisition analogique",
          "protocol": "GPIO/Timing",
          "description": "Mesure pulse HC-SR04 → RMS (A/V); calibration linéaire."
        },
        {
          "id": "f_leds",
          "source": "bbb1",
          "target": "leds",
          "name": "Commande logique",
          "protocol": "GPIO",
          "description": "BTS: LED rouge=trip, verte=normal selon seuil+TMS."
        },
        {
          "id": "f1",
          "source": "pc1",
          "target": "bbb1",
          "name": "HTTP Config",
          "protocol": "HTTP",
          "description": "ArkStudio: GET/POST /config, /apply, /logs (port 9090)",
          "properties": { "port": 9090 }
        },
        {
          "id": "f2",
          "source": "bbb1",
          "target": "bbb2",
          "name": "MMS Multicast",
          "protocol": "UDP",
          "description": "239.0.0.1:5005, interface 192.168.0.101, TTL=1 (limite LAN).",
          "properties": { "group": "239.0.0.1", "port": 5005, "ttl": 1 }
        },
        {
          "id": "f3",
          "source": "bbb2",
          "target": "pc2",
          "name": "UDP Forward",
          "protocol": "UDP",
          "description": "Unicast 192.168.8.2 → 192.168.8.1:5006 (listener PC2).",
          "properties": { "port": 5006 }
        }
      ]
    }
  ],
  "threats": [
    {
      "id": "T-HTTP-EAVESDROP",
      "title": "Eavesdropping configuration HTTP",
      "category": "STRIDE: Information Disclosure",
      "description": "La config ArkStudio transite en clair si HTTP (réseau 192.168.7.x).",
      "severity": "High",
      "status": "Open",
      "mitigations": [
        "Basculer en HTTPS (cert local) ou restreindre à interface USB",
        "Token d'accès ↔ filtrage IP (PC1 uniquement)"
      ]
    },
    {
      "id": "T-MCAST-SPOOF",
      "title": "Spoofing/Injection sur MMS multicast",
      "category": "STRIDE: Spoofing/Tampering",
      "description": "Paquets UDP multicast non authentifiés; un attaquant sur 192.168.0.x peut injecter.",
      "severity": "Medium",
      "status": "Open",
      "mitigations": [
        "Inclure signature/HMAC dans payload MMS-like",
        "Limiter domaine (TTL=1), segment isolé, monitoring (tcpdump)"
      ]
    },
    {
      "id": "T-DOS-RT",
      "title": "Déni de service sur la boucle RT",
      "category": "STRIDE: Denial of Service",
      "description": "Charge CPU, HTTP excessif ou blocages peuvent retarder la tâche RT.",
      "severity": "Medium",
      "status": "Open",
      "mitigations": [
        "Thread RT en SCHED_FIFO + mlockall",
        "Watchdog avec état de sûreté (LED rouge + log + alerte)"
      ]
    },
    {
      "id": "T-FWD-LEAK",
      "title": "Exfiltration/écoute sur segment SCADA",
      "category": "STRIDE: Information Disclosure",
      "description": "Forward UDP non chifré vers PC2; un hôte local peut sniffer.",
      "severity": "Low",
      "status": "Open",
      "mitigations": [
        "Filtrage IP, firewall, VLAN/segmentation",
        "Option: payload chiffré ou VPN"
      ]
    }
  ]
}
